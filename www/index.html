<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Testing phonegap plugins</title>
  </head>
  <body>
    <textarea id="mylogs" style="width: 100%; height: 100%;">
    </textarea>

    <script src="https://www.gstatic.com/firebasejs/4.5.0/firebase.js"></script>
    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <script>
      function mylog(msg) {
        document.getElementById('mylogs').value += msg + "\n";
      }

      mylog('waiting for deviceready');
      document.addEventListener('deviceready', onDeviceReady, false);
      
      function onDeviceReady() {
        mylog('Got deviceready');
        setUpPushNotification();
        signInWithGoogle();
      }

      function signInWithGoogle() {
        var provider = new firebase.auth.GoogleAuthProvider();
        firebase.auth().signInWithRedirect(provider).then(function() {
          return firebase.auth().getRedirectResult();
        }).then(function(result) {
          // This gives you a Google Access Token.
          // You can use it to access the Google API.
          var token = result.credential.accessToken;
          // The signed-in user info.
          var user = result.user;
          mylog('Google login succeeded! token=' + token + ' user=' + user.uid);
        }).catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          mylog('Google login failed! errorCode=' + errorCode + ' errorMessage=' + errorMessage);
        });
      }

      function setUpPushNotification() {
        if (!FCMPlugin) {
          mylog("FCMPlugin not installed!");
          return;
        }
        FCMPlugin.onTokenRefresh(function(token){
          mylog("onTokenRefresh token=" + token);
        });
        FCMPlugin.getToken(function(token){
          mylog("getToken token=" + token);
        });
        FCMPlugin.onNotification(function(data){
          mylog("onNotification data=" + JSON.stringify(data) );
          if(data.wasTapped){
            //Notification was received on device tray and tapped by the user.
          }else{
            //Notification was received in foreground. Maybe the user needs to be notified.
          }
        });

      }
    </script>
  </body>
</html>
